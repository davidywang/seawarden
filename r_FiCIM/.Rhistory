list<-list.files(folder2, pattern = '.txt')
print(list)}
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/', pattern = '.txt')
print(list)}
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/', pattern = '.txt'))
print(list)}
folder2
list.files(paste0(folder2, '/Outputs/', pattern = '.txt'))
(paste0(folder2, '/Outputs/', pattern = '.txt')
paste0(folder2, '/Outputs/', pattern = '.txt')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt'))
list.files(paste0(folder2, '/Outputs/')
paste0(folder2, '/Outputs/')
paste0(folder2, '/Outputs/')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
print(list)}
list[2:6]
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/', list[i+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(folder2, '/Outputs/', '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/', list[i+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(folder2, '/Outputs/', out_list[i], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(folder2, '/Outputs/', out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(folder2, '/Outputs/', out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j+1]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)
list<-list.files(paste0(folder2, '/Outputs/'), pattern = '.txt')
datalist = list()
for (j in 1:6){
name <- paste0(folder2, '/Outputs/', list[j+1])
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', out_list[j], '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
for (i in files){
list<-list.files(paste0(input, '/Outputs/', i), pattern = '.txt')
print(list)}
for (i in files){
list<-list.files(paste0(input, '/Outputs/', strsplit(i, ".zip")), pattern = '.txt')
print(list)}
list
list.files(paste0(input, '/Outputs/', strsplit(i, ".zip")), pattern = '.txt')
paste0(input, '/Outputs/', strsplit(i, ".zip"))
strsplit(i, ".zip")
strsplit(i, ".zip")
i
files
list.files(path = input, pattern = "*.zip")
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
out_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
folder <- paste0(input, '/', i)
folder2 <- paste0(input, '/', strsplit(i, ".zip"))
unzip(folder, exdir=folder2)}
for (i in files){
list<-list.files(paste0(input, '/Outputs/', strsplit(i, ".zip")), pattern = '.txt')
print(list)}
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_day5_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = input)
txt_list <- list.files(paste0(input, '/Outputs'))}
#txt_list <- c('Flux_C_0005', 'Flux_N_0005', 'Flux_P_0005', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
#txt_list <- c('Flux_C_0005_07', 'Flux_N_0005_07', 'Flux_P_0005_07', 'Mean_Flux_C_07', 'Mean_Flux_N_07', 'Mean_Flux_P_07')
txt_list <- c('Flux_C_0005_06', 'Flux_N_0005_06', 'Flux_P_0005_06', 'Mean_Flux_C_06', 'Mean_Flux_N_06', 'Mean_Flux_P_06')
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = i)
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_day5_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = input)
txt_list <- list.files(paste0(input, '/Outputs'))}
#txt_list <- c('Flux_C_0005', 'Flux_N_0005', 'Flux_P_0005', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
#txt_list <- c('Flux_C_0005_07', 'Flux_N_0005_07', 'Flux_P_0005_07', 'Mean_Flux_C_07', 'Mean_Flux_N_07', 'Mean_Flux_P_07')
txt_list <- c('Flux_C_0005_06', 'Flux_N_0005_06', 'Flux_P_0005_06', 'Mean_Flux_C_06', 'Mean_Flux_N_06', 'Mean_Flux_P_06')
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = .txt)
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
list.files(path = paste0(input, '/Outputs'), pattern = .txt)
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_day5_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = input)
txt_list <- list.files(paste0(input, '/Outputs'))}
#txt_list <- c('Flux_C_0005', 'Flux_N_0005', 'Flux_P_0005', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
#txt_list <- c('Flux_C_0005_07', 'Flux_N_0005_07', 'Flux_P_0005_07', 'Mean_Flux_C_07', 'Mean_Flux_N_07', 'Mean_Flux_P_07')
txt_list <- c('Flux_C_0005_06', 'Flux_N_0005_06', 'Flux_P_0005_06', 'Mean_Flux_C_06', 'Mean_Flux_N_06', 'Mean_Flux_P_06')
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = '.txt')
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
list.files(path = paste0(input, '/Outputs'), pattern = '.txt')
list.files(path = paste0(input, '/Outputs'))
for (i in files){
unzip(paste0(input, '/', i), exdir = paste0(input, '/', strsplit(i, ".")[1]))
txt_list <- list.files(paste0(input, '/Outputs'))}
strsplit(i, ".")[1]
i
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_day5_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = paste0(input, '/', strsplit(i, ".")[1]))
txt_list <- list.files(paste0(input, '/Outputs'))}
i
files
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
input <- './ficim_54_day200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = paste0(input, '/', strsplit(i, ".")[1]))
txt_list <- list.files(paste0(input, '/Outputs'))}
print(length(files))
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = paste0(input, '/', strsplit(i, ".")[1]))
txt_list <- list.files(paste0(input, '/Outputs'))}
for (i in files){
unzip(paste0(input, '/', i), exdir = input)}
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
print(length(files))
for (i in files){
unzip(paste0(input, '/', i), exdir = input)}
txt_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = i)
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
library(dplyr)
#load farm sites
# farmsites <- read.csv('../r_rac/master_inventory - Farm_Sites.csv', header=TRUE, sep=",")
# sites <- farmsites$farm_site
sites <-54
#input folders
rac_folder <- '../r_rac/rac_seabass/'
site_folder <- '/Bass_population/Outputs/Out_csv/'
rac_folder_2 <- '../r_rac/rac_bream/'
site_folder_2 <- '/Bream_population/Outputs/Out_csv/'
#output folder
folder <- "../r_ficim/"
#function to convert RAC predictions to C, N, P
waste_compiler <- function(rac_folder, site_folder, i, h_size){
compiled <- read.csv(paste0(rac_folder, 'output_compiled/site_', i, '_compiled.csv'), header=TRUE, sep=",")
Pexc <- compiled$faeces_p*.4 + compiled$faeces_l*2.3 + compiled$faeces_c*0
Nexc <- compiled$faeces_p*15.9 + compiled$faeces_l*2.6 + compiled$faeces_c*0
Cexc <- compiled$faeces_p*54.5 + compiled$faeces_l*77 + compiled$faeces_c*40
Pwst <- compiled$feed_p*.4 + compiled$feed_l*2.3 + compiled$feed_c*0
Nwst <- compiled$feed_p*15.9 + compiled$feed_l*2.6 + compiled$feed_c*0
Cwst <- compiled$feed_p*54.5 + compiled$feed_l*77 + compiled$feed_c*40
compiled <- data.frame(cbind(compiled$day, Pexc, Nexc, Cexc, Pwst, Nwst, Cwst))
#colnames(compiled) <- c("Day", "Pexc (g)", "Nexc (g)", "Cexc (g)", "Pwst (g)", "Nwst (g)", "Cwst (g)")
#harvest <-  read.csv(paste0(rac_folder, 'site_', i, site_folder, 'Days_to_commercial_size.csv'))
#harvest <- harvest %>% select(3)
#harvest <- min(which(compiled$weight_1 > h_size))
#harvest <- harvest[[1]]
#compiled <- compiled[1:harvest,]
compiled <- compiled[200:207,] #mid 7 day select
name <- paste0(rac_folder, 'output_waste/', i, '_total_waste.csv')
write.table(compiled, file = name, row.names=FALSE, col.names = TRUE, sep=",")}
#prepare total waste conversions for all sites
for (i in sites){
waste_compiler(rac_folder, site_folder, i, 350) #bream
waste_compiler(rac_folder_2, site_folder_2, i, 450)} #seabass
#generate txt files specific to farm site, part 1
site_id = sites
#load farm site data
site <- read.csv(paste0(folder, 'FiCIM - ', site_id, '.csv'), header=TRUE, sep=",", stringsAsFactors = FALSE)
site <-na.omit(site)
#load param template
param <- read.csv(paste0(folder, 'FiCIM - Param.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
#load date template
date <- read.csv(paste0(folder, 'FiCIM - Julian_Day.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
hr <- read.csv(paste0(folder, 'FiCIM - Julian_Hr.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
#load bath and current data
bath <- "../data_bath/bath_txt/"
current <- "../data_current/current_txt/"
#copy bath and current data
file.copy(paste0(bath, site_id, "_bath.txt"), folder, overwrite = TRUE) #xport bath
#file.copy(paste0(current, site_id, "_current.txt"), folder, overwrite = TRUE) #export current
#add date to current data
v_plus <- 5 #increase current by 10x
c <- read.delim(paste0(current, site_id, "_current.txt"), header = FALSE, sep = "\t")
h <- rep(hr, nrow(c)/24)
d <- rep(date$V4, each = 24) + unlist(h)
c <- as.data.frame(cbind(d, c$V1*v_plus, c$V2*v_plus))
c <- c %>% rename("Julian Hour" = d, "u (m/s)" = V2, "v (m/s)" = V3)
c <- c[200:368,] #mid 7 day select
name <- paste0(folder, site_id, '_current.txt')
write.table(c, name, sep = "\t", row.names=FALSE, col.names=TRUE, quote = FALSE)
#generate txt files specific to farm site, part 2
index <- nrow(site)
#index <- 1
for (i in 1:index){
#load total_waste.csv
name <- paste0("/Users/Zack/0_seawarden/r_rac/rac_", site$Species[i], '/output_waste/', site$farm_id[i], '_total_waste.csv')
waste <- read.csv(name, header=TRUE, sep=",", stringsAsFactors = FALSE)
#param.txt
param$V1[2] <- 7 #nrow(waste) #days
param$V2[2] <- site$Species.Index[i] #species
param$V3[2] <- site$ORIG_FID[i] #cage number
param$V4[2] <- site$Cgx[i] #cage position
param$V5[2] <- site$Cgy[i] #cage position
param$V1[6] <- 0 #0 = no bath
param$V2[6] <- -65 #-15 #depth (meters)
#reduce total waste to net pen
waste <- waste[2:7] * as.numeric(site$Percentage[i]) #reduce waste total to net pen size
waste <- round(waste, 5)
waste <- cbind(date$V4[1:nrow(waste)], waste) #add julian date, combine with waste
names(waste)[1] <- "Day"
#export param.txt
name <- paste0(folder, site$farm_id[i], '_', site$ORIG_FID[i], '_param_', site$Species[i], '.txt')
write.table(param, name, sep = "\t", row.names=FALSE, col.names=FALSE, quote = FALSE)
#export total_waste.txt
name <- paste0(folder, site$farm_id[i], '_', site$ORIG_FID[i], '_total_waste_', site$Species[i], '.txt')
write.table(waste, sep = "        ", name, row.names=FALSE, col.names=TRUE, quote = FALSE)}
library(dplyr)
#load farm sites
# farmsites <- read.csv('../r_rac/master_inventory - Farm_Sites.csv', header=TRUE, sep=",")
# sites <- farmsites$farm_site
sites <-54
#input folders
rac_folder <- '../r_rac/rac_seabass/'
site_folder <- '/Bass_population/Outputs/Out_csv/'
rac_folder_2 <- '../r_rac/rac_bream/'
site_folder_2 <- '/Bream_population/Outputs/Out_csv/'
#output folder
folder <- "../r_ficim/"
#function to convert RAC predictions to C, N, P
waste_compiler <- function(rac_folder, site_folder, i, h_size){
compiled <- read.csv(paste0(rac_folder, 'output_compiled/site_', i, '_compiled.csv'), header=TRUE, sep=",")
Pexc <- compiled$faeces_p*.4 + compiled$faeces_l*2.3 + compiled$faeces_c*0
Nexc <- compiled$faeces_p*15.9 + compiled$faeces_l*2.6 + compiled$faeces_c*0
Cexc <- compiled$faeces_p*54.5 + compiled$faeces_l*77 + compiled$faeces_c*40
Pwst <- compiled$feed_p*.4 + compiled$feed_l*2.3 + compiled$feed_c*0
Nwst <- compiled$feed_p*15.9 + compiled$feed_l*2.6 + compiled$feed_c*0
Cwst <- compiled$feed_p*54.5 + compiled$feed_l*77 + compiled$feed_c*40
compiled <- data.frame(cbind(compiled$day, Pexc, Nexc, Cexc, Pwst, Nwst, Cwst))
#colnames(compiled) <- c("Day", "Pexc (g)", "Nexc (g)", "Cexc (g)", "Pwst (g)", "Nwst (g)", "Cwst (g)")
#harvest <-  read.csv(paste0(rac_folder, 'site_', i, site_folder, 'Days_to_commercial_size.csv'))
#harvest <- harvest %>% select(3)
#harvest <- min(which(compiled$weight_1 > h_size))
#harvest <- harvest[[1]]
#compiled <- compiled[1:harvest,]
compiled <- compiled[200:207,] #mid 7 day select
name <- paste0(rac_folder, 'output_waste/', i, '_total_waste.csv')
write.table(compiled, file = name, row.names=FALSE, col.names = TRUE, sep=",")}
#prepare total waste conversions for all sites
for (i in sites){
waste_compiler(rac_folder, site_folder, i, 350) #bream
waste_compiler(rac_folder_2, site_folder_2, i, 450)} #seabass
#generate txt files specific to farm site, part 1
site_id = sites
#load farm site data
site <- read.csv(paste0(folder, 'FiCIM - ', site_id, '.csv'), header=TRUE, sep=",", stringsAsFactors = FALSE)
site <-na.omit(site)
#load param template
param <- read.csv(paste0(folder, 'FiCIM - Param.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
#load date template
date <- read.csv(paste0(folder, 'FiCIM - Julian_Day.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
hr <- read.csv(paste0(folder, 'FiCIM - Julian_Hr.csv'), header=FALSE, sep=",", stringsAsFactors = FALSE)
#load bath and current data
bath <- "../data_bath/bath_txt/"
current <- "../data_current/current_txt/"
#copy bath and current data
file.copy(paste0(bath, site_id, "_bath.txt"), folder, overwrite = TRUE) #xport bath
#file.copy(paste0(current, site_id, "_current.txt"), folder, overwrite = TRUE) #export current
#add date to current data
v_plus <- 20 #increase current
c <- read.delim(paste0(current, site_id, "_current.txt"), header = FALSE, sep = "\t")
h <- rep(hr, nrow(c)/24)
d <- rep(date$V4, each = 24) + unlist(h)
c <- as.data.frame(cbind(d, c$V1*v_plus, c$V2*v_plus))
c <- c %>% rename("Julian Hour" = d, "u (m/s)" = V2, "v (m/s)" = V3)
c <- c[200:368,] #mid 7 day select
name <- paste0(folder, site_id, '_current.txt')
write.table(c, name, sep = "\t", row.names=FALSE, col.names=TRUE, quote = FALSE)
#generate txt files specific to farm site, part 2
index <- nrow(site)
#index <- 1
for (i in 1:index){
#load total_waste.csv
name <- paste0("/Users/Zack/0_seawarden/r_rac/rac_", site$Species[i], '/output_waste/', site$farm_id[i], '_total_waste.csv')
waste <- read.csv(name, header=TRUE, sep=",", stringsAsFactors = FALSE)
#param.txt
param$V1[2] <- 7 #nrow(waste) #days
param$V2[2] <- site$Species.Index[i] #species
param$V3[2] <- site$ORIG_FID[i] #cage number
param$V4[2] <- site$Cgx[i] #cage position
param$V5[2] <- site$Cgy[i] #cage position
param$V1[6] <- 0 #0 = no bath
param$V2[6] <- -65 #-15 #depth (meters)
#reduce total waste to net pen
waste <- waste[2:7] * as.numeric(site$Percentage[i]) #reduce waste total to net pen size
waste <- round(waste, 5)
waste <- cbind(date$V4[1:nrow(waste)], waste) #add julian date, combine with waste
names(waste)[1] <- "Day"
#export param.txt
name <- paste0(folder, site$farm_id[i], '_', site$ORIG_FID[i], '_param_', site$Species[i], '.txt')
write.table(param, name, sep = "\t", row.names=FALSE, col.names=FALSE, quote = FALSE)
#export total_waste.txt
name <- paste0(folder, site$farm_id[i], '_', site$ORIG_FID[i], '_total_waste_', site$Species[i], '.txt')
write.table(waste, sep = "        ", name, row.names=FALSE, col.names=TRUE, quote = FALSE)}
library(dplyr)
#input <- './ficim_54_day5_bath65'
input <- './ficim_54_days200_207_bath65_cur10'
files <- list.files(path = input, pattern = "*.zip")
txt_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
unzip(paste0(input, '/', i), exdir = input)}
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = i)
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
library(dplyr)
#input <- './ficim_54_day5_bath65'
#input <- './ficim_54_days200_207_bath65_cur10'
input <- './ficim_54_days200_207_bath65_cur'
files <- list.files(path = input, pattern = "*.zip")
txt_list <- c('Flux_C', 'Flux_N', 'Flux_P', 'Mean_Flux_C', 'Mean_Flux_N', 'Mean_Flux_P')
for (i in files){
unzip(paste0(input, '/', i), exdir = input)}
for (i in txt_list){
list_fc <- list.files(path = paste0(input, '/Outputs'), pattern = i)
print(list_fc)
datalist = list()
for (j in list_fc){
name <- paste0(input, '/Outputs/', j)
txt <- read.table(name, header = FALSE)
datalist[[j]] <- txt}
combined <- Reduce('+', datalist)
write.table(c(t(combined)), file = paste0(input, '/', i, '_list.csv'), row.names=FALSE, col.names=FALSE, sep=",")}
