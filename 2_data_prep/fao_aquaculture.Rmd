
```{r}
library(dplyr)
library(plyr)
library(tidyverse)
library(ggplot2)
```

```{r}
#download UNFAO data as zipfile and unzip 
#url <- "http://www.fao.org/fishery/static/Data/Aquaculture_2018.1.2.zip" #2018 dataset
#url <- "http://www.fao.org/fishery/static/Data/Aquaculture_2019.1.0.zip" #2019 dataset
url <- "http://www.fao.org/fishery/static/Data/Aquaculture_2020.1.0.zip" #2019 dataset

temp <- tempfile()
temp2 <- tempfile()

download.file(url, temp)
unzip(zipfile = temp, exdir = temp2)
```

```{r}
#create dataframes from CSVs
aquaculture <- read_csv(file.path(temp2, "TS_FI_AQUACULTURE.csv"))
environment <- read_csv(file.path(temp2, "CL_FI_ENVIRONMENT.csv"))
country <- read_csv(file.path(temp2, "CL_FI_COUNTRY_GROUPS.csv"))
units <- read_csv(file.path(temp2, "CL_FI_UNIT.csv"))
species <- read_csv(file.path(temp2, "CL_FI_SPECIES_GROUPS.csv"))

#select specific columns for certain CSVs
environment <- environment %>% 
  dplyr::select(Identifier, Name_En)

country <- country %>% 
  dplyr::select(UN_Code, ISO3_Code, Name_En)

units <- units %>% 
  dplyr::select(Code, Name_En)

species <- species %>% 
  dplyr::select("3Alpha_Code", Major_Group, Name_En)
```

```{r}
#join tables together to create dataframe that can be filtered by: year, enviornment, and species group (PISCES=FISH)
aquaculture_all <- aquaculture %>%
  left_join(environment, by = c("ENVIRONMENT" = "Identifier")) %>%
  left_join(species, by = c("SPECIES"= "3Alpha_Code")) %>%
  left_join(country, by = c("COUNTRY" = "UN_Code")) %>%
  
  dplyr::rename("ENVIRONMENT_NAME" = "Name_En.x", 
                "SPECIES_NAME" = "Name_En.y", 
                "COUNTRY_NAME" = "Name_En", 
                "TONNES" = "QUANTITY", 
                "GROUP" = "Major_Group") %>%
  dplyr::select(-ENVIRONMENT, -COUNTRY, -SPECIES, -QUANTITY_UNIT, -QUANTITY_SYMBOL, -VALUE_SYMBOL) %>%
  dplyr::select(COUNTRY_NAME, ENVIRONMENT_NAME, GROUP, SPECIES_NAME, TONNES, YEAR) %>%
  #filter(YEAR == 2018) %>%
  mutate(TONNES = round(TONNES, 1))

aquaculture_all

#export dataframe as csv
#write.table(aquaculture_all, file = '../fao_2020_2018only.csv', row.names=FALSE, col.names = TRUE, sep=",")
```

```{r}
# aquaculture_bass <- aquaculture_all %>%
#   filter(ENVIRONMENT_NAME == "Marine", SPECIES_NAME == "European seabass", COUNTRY_NAME == "Greece") 
#   
# ggplot(aquaculture_bass, aes(x=YEAR)) + 
#   geom_line(aes(y = TONNES))#, color = "darkred") 
```

```{r}
# aquaculture_bream <- aquaculture_all %>%
#   filter(ENVIRONMENT_NAME == "Marine", SPECIES_NAME == "Gilthead seabream", COUNTRY_NAME == "Greece") 
#   
# ggplot(aquaculture_bream, aes(x=YEAR)) + 
#   geom_line(aes(y = TONNES))#, color = "darkred") 
```

```{r}
#seabass and bream produciton in Greece
aquaculture_2 <- aquaculture_all %>%
  filter(ENVIRONMENT_NAME == "Marine", SPECIES_NAME == c("Gilthead seabream", "European seabass"), COUNTRY_NAME == "Greece") 
  
ggplot(aquaculture_2, aes(x = YEAR, y = TONNES)) + 
  geom_line(aes(color = SPECIES_NAME)) +
  labs(title="Greek Production of European Seabass and Gilthead seabream", x ="year", y="Tonnes") +
  scale_fill_discrete(name = "Dose", labels = c("A", "B"))

```


```{r}
#all fish production in Greece
aquaculture_greece <- aquaculture_all %>%
  filter(ENVIRONMENT_NAME == "Marine", GROUP == "PISCES", COUNTRY_NAME == "Greece") 
  
#ggplot(aquaculture_x, aes(x=YEAR)) + 
#  geom_line(aes(y = TONNES), color = "darkred") 

ggplot(aquaculture_greece, aes(x = YEAR, y = TONNES)) + 
  geom_line(aes(color = SPECIES_NAME, linetype = SPECIES_NAME)) #+ 
  #scale_color_manual(values = c("darkred", "steelblue"))
```








