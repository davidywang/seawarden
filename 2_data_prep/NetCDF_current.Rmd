```{r load_packages, warning=FALSE, message=FALSE}
library(ncdf4) # package for netcdf manipulation
library(raster) # package for raster manipulation
library(sf)
library(rgdal) # package for geospatial analysis

###FILE
#file <- '/Users/Zack/0_thesis_ocean_current/med-cmcc-cur-an-fc-d_1570770016641.nc'
#file <- '/Users/Zack/0_thesis_ocean_current/med-cmcc-cur-an-fc-d_1577058742260.nc'

#file <- '/Users/Zack/0_thesis_ocean_current_2/med-cmcc-cur-an-fc-d_1581439345543.nc' #2018a
#file <- '/Users/Zack/0_thesis_ocean_current_2/med-cmcc-cur-an-fc-d_1581439751731.nc' #2018b
#file <- '/Users/Zack/0_thesis_ocean_current_2/med-cmcc-cur-an-fc-d_1581439977520.nc' #2019a
file <- '/Users/Zack/0_thesis_ocean_current_2/med-cmcc-cur-an-fc-d_1581440302082.nc' #2019b

###DATE
#date_range <- seq(as.Date("2018/01/01"), as.Date("2019/01/01"), "days")
#date_range <- seq(as.Date("2019/01/01"), as.Date("2019/12/31"), "days")

#date_range <- seq(as.Date("2018/01/01"), as.Date("2018/07/01"), "days")
#date_range <- seq(as.Date("2018/07/02"), as.Date("2019/01/01"), "days")
#date_range <- seq(as.Date("2019/01/02"), as.Date("2019/07/01"), "days")
date_range <- seq(as.Date("2019/07/02"), as.Date("2020/01/01"), "days")

###OUTPUT
filepath_vo <- paste("/Users/Zack/0_thesis_ocean_current/vo_2019/")
filepath_uo <- paste("/Users/Zack/0_thesis_ocean_current/uo_2019/")

#open nc file
nc_data <- nc_open(file)

# get the depth, lat, lon, and time coordinates
t <- ncvar_get(nc_data, "time")
d <- ncvar_get(nc_data, "depth")
lon <- ncvar_get(nc_data, "lon")
lat <- ncvar_get(nc_data, "lat")
#nc_close(nc_data) 

length(t)

#vo
vo.array <- ncvar_get(nc_data, "vo") # store the data in a 3-dimensional array
fillvalue <- ncatt_get(nc_data, "vo", "_FillValue") # get the fill value
vo.array[vo.array == fillvalue$value] <- NA

for (i in 1:length(t)){
  vo.slice <- vo.array[,,i] # get the first time slice
  
  # save this time slice as a raster
  r <- raster(t(vo.slice), xmn=min(lon), xmx=max(lon), ymn=min(lat), ymx=max(lat), crs=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0"))
  r <- flip(r, direction='y')

  name <- (paste(filepath_vo, "medsea_vo_", paste(date_range[i]), ".tif", sep=""))
  
  #save as geotiff
  writeRaster(r, name, "GTiff", overwrite=TRUE)}

#uo
uo.array <- ncvar_get(nc_data, "uo") # store the data in a 3-dimensional array
fillvalue <- ncatt_get(nc_data, "uo", "_FillValue") # get the fill value
uo.array[uo.array == fillvalue$value] <- NA

for (i in 1:(length(t))){
  uo.slice <- uo.array[,,i] # get the first time slice
  
  # save this time slice as a raster
  r <- raster(t(uo.slice), xmn=min(lon), xmx=max(lon), ymn=min(lat), ymx=max(lat), crs=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0"))
  r <- flip(r, direction='y')

  name <- (paste(filepath_uo, "medsea_uo_", paste(date_range[i]), ".tif", sep=""))
  
  #save as geotiff
  writeRaster(r, name, "GTiff", overwrite=TRUE)}
```





