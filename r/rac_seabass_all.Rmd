---
title: "rac_seabass_all"
author: "Zack Dinh"
date: "September 4, 2019"
output: html_document
---

```{r}
library(RAC)
library(dplyr)
#command + shift + c

#load sst files
#sst_folder <- '/Users/Zack/0_thesis_sst/ghrsst_2018_csv/'
sst_folder <- '/Users/Zack/0_thesis_sst/ghrsst_csv_test/'
sst_list <- list.files(sst_folder, pattern = '.csv')

#load master files
rac_folder <- "/Users/Zack/0_seawarden/r/RAC_seabass_all/"
master_files <- paste0(rac_folder, 'master_files/')

master_Feeding <- read.csv(paste0(master_files, 'master_RAC-seabass - Feeding.csv'), header=TRUE, sep=",")
master_Food <- read.csv(paste0(master_files, 'master_RAC-seabass - Food_Characterization.csv'), header=FALSE, sep=",")
master_Parameters <- read.csv(paste0(master_files, 'master_RAC-seabass - Parameters.csv'), header=FALSE, sep=",")
master_Management <- read.csv(paste0(master_files, 'master_RAC-seabass - Management.csv'), header=FALSE, sep=",")
master_Population <- read.csv(paste0(master_files, 'master_RAC-seabass - Population.csv'), header=FALSE, sep=",")
```

```{r}
#create folder for each site, #add SST data
#sites <- length(sst_list)
sites <- 2
 
for (i in 0:sites){
  #create a folder for each site
  site_folder <- paste0(rac_folder, 'site_', i, '/')  
  dir.create(site_folder) 
  
  #create RAC folders for each site
  Bass_pop_skeleton(site_folder) 
  
  #add SST data
  orglocation <- paste0(sst_folder, i, '_sst.csv')
  newlocation <- paste0(site_folder, 'Bass_population/Inputs/Forcings/')
  file.copy(from=orglocation, to=newlocation, overwrite = TRUE, recursive = FALSE, copy.mode = TRUE)
  file.remove(paste0(newlocation, 'Water_temperature.csv'))
  file.rename(paste0(newlocation, i, '_sst.csv'), paste0(newlocation, 'Water_temperature.csv'))}
```

```{r}
#generate Feeding.csv for each site
for (i in 0:sites){
  #column <- 2 + i
  #export <- master_Feeding %>% select(1, column)
  export <- master_Feeding %>% select(1, 2)
  output <- paste0(rac_folder, 'site_', i, '/Bass_population/Inputs/Forcings/Feeding.csv')
  write.table(export, file = output, row.names=FALSE, col.names = FALSE, sep=",")}

#generate Food_Characterization.csv for each site (same for all sites)
for (i in 0:sites){
  export <- master_Food %>% select(2, 1)
  export <- export[-1,] #drop header
  output <- paste0(rac_folder, 'site_', i, '/Bass_population/Inputs/Forcings/Food_Characterization.csv')
  write.table(export, file = output, row.names=FALSE, col.names = FALSE, sep=",")}

#generate Management.csv for each site (same for all sites)
for (i in 0:sites){
  #column <- i + 3
  #export <- master_Management %>% select(1, 2, column)
  export <- master_Management %>% select(1, 2, 3)
  output <- paste0(rac_folder, 'site_', i, '/Bass_population/Inputs/Population_management/Management.csv')
  write.table(export, file = output, row.names=FALSE, col.names = FALSE, sep=",")}

#generate Parameters.csv for each site (same for all sites)
for (i in 0:sites){
  export <- master_Parameters %>% select(1, 2, 5, 3, 4)
  output <- paste0(rac_folder, 'site_', i, '/Bass_population/Inputs/Parameters/Parameters.csv')
  write.table(export, file = output, row.names=FALSE, col.names = FALSE, sep=",")}

#generate Population.csv for each site
for (i in 0:sites){
  column <- i + 5
  export <- master_Population %>% select(1, 2, column, 3, 4)
  output <- paste0(rac_folder, 'site_', i, '/Bass_population/Inputs/Parameters/Population.csv')
  write.table(export, file = output, row.names=FALSE, col.names = FALSE, sep=",")}
```

```{r}
#delete selector = "y"
trace(Bass_pop_main,edit=T)

for (i in 0:sites){
  userpath <- paste0(rac_folder, "site_", i)
  
  #working directory
  setwd(userpath) 
  
  #load environmental variables
  forcings <- Bass_pop_dataloader(userpath) 
 
  #run growth model
  output <- Bass_pop_main(userpath, forcings)}
```

